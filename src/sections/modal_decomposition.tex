\section{Modal Decomposition}

\subsection{Recall: Eigendecomposition}
Let $\lambda_i$ and $\mathbf{v}_i$ be an eigenvalue and an eigenvector of $\mathbf{A}$.
\begin{align*}
    \mathbf{Av}_i & = \lambda_i \mathbf{v}_i                                   \\
    \mathbf{A} \begin{bmatrix}
                   \vdots       &        & \vdots       \\
                   \mathbf{v}_1 & \cdots & \mathbf{v}_n \\
                   \vdots       &        & \vdots
               \end{bmatrix}
                  & = \begin{bmatrix}
                          \vdots                 &        & \vdots                 \\
                          \lambda_1 \mathbf{v}_1 & \cdots & \lambda_n \mathbf{v}_n \\
                          \vdots                 &        & \vdots
                      \end{bmatrix} \\
                  & = \underbrace{\begin{bmatrix}
                                          \vdots       &        & \vdots       \\
                                          \mathbf{v}_1 & \cdots & \mathbf{v}_n \\
                                          \vdots       &        & \vdots
                                      \end{bmatrix}}_{V}
    \underbrace{\begin{bmatrix}
                        \lambda_1 & 0      & 0         \\
                        0         & \ddots & 0         \\
                        0         & 0      & \lambda_n
                    \end{bmatrix}}_{\Lambda}                                 \\
    \mathbf{AV}   & = \mathbf{V}\bm{\Lambda}                                   \\
    \bm{\Lambda}  & = \mathbf{V}^{-1}\mathbf{AV}
\end{align*}
As shown $\bm{\Lambda}$ is a diagonal matrix containing the eigenvalues of $\mathbf{A}$ and $\mathbf{V}$ is a column stack of the eigenvectors.

\subsection{Similarity Transformation}
The state space representation is not unique. This can be used to transform the model into a more \flqq{}useful/readable\frqq{} representation.
\begin{align*}
    \tilde{\mathbf{x}} & = \mathbf{Tx}       \\
    \tilde{\mathbf{A}} & = \mathbf{TAT}^{-1} \\
    \tilde{\mathbf{B}} & = \mathbf{TB}       \\
    \tilde{\mathbf{C}} & = \mathbf{CT}^{-1}  \\
    \tilde{\mathbf{D}} & = \mathbf{D}
\end{align*}
\subsubsection{Modal Transformation}
If $\mathbf{T}$ is set to the inverse of the eigenvector matrix of $\mathbf{A}$ we get:
\begin{align*}
    \mathbf{T}         & = \mathbf{V}^{-1}                           \\
    \tilde{\mathbf{x}} & = \mathbf{V}^{-1}\mathbf{x}                 \\
    \tilde{\mathbf{A}} & = \mathbf{V}^{-1}\mathbf{AV} = \bm{\Lambda} \\
    \tilde{\mathbf{B}} & = \mathbf{V}^{-1}\mathbf{B}                 \\
    \tilde{\mathbf{C}} & = \mathbf{CV}                               \\
    \tilde{\mathbf{D}} & = \mathbf{D}
\end{align*}
Where $\tilde{\mathbf{A}}$ is a diagonal matrix with the eigenvalues of $\mathbf{A}$ on its main diagonal.

\subsection{Modal Time Response}
\subsubsection{Modal Coordinates}
\begin{itemize}
    \item The eigenvector $\mathbf{v}_i$ defines the shape of the $i$-th mode.
    \item The modal coordinate $\tilde{\mathbf{x}}_i=\mathbf{V}^{-1}\mathbf{x}$ scales the mode (e.g., at the initial condition)
    \item The eigenvalue $\lambda_i$ defines how the amplitude of the mode evolves over time.

          \begin{tabularx}{\linewidth}{@{}p{0.5\linewidth}X@{}}
              \quad Real $\lambda_i$                            & \textrightarrow{} $e^{\lambda_i t}x_i(0)$                         \\
              \quad Complex $\lambda_i = \sigma_i + j \omega_i$ & \textrightarrow{} $e^{\sigma_i t}\sin(\omega_i t + \phi_0)x_i(0)$ \\
              \quad Repeated $\lambda_i$                        & \textrightarrow{} $t^p e^{\lambda_i t}$
          \end{tabularx}
\end{itemize}

\begin{examplesection}[Example: Interpretation of Modal Decomposition]
    The modal decomposition gives valuable insight regarding the behavior of a system. The modes (eigenvalues and corresponding eigenvectors) are analyzed one at a time.
    \begin{enumerate}
        \item The magnitude of the eigenvalue describes the influence of the corresponding mode.
        \item The property (real, complex or repeated) of the eigenvalue describes the behavior over time of that mode.
        \item The corresponding eigenvector describes the states/dimensions the mode is acting on. For example $x,y,z$ or $\varphi, \dot{\varphi}$
    \end{enumerate}
\end{examplesection}

\subsubsection{Homogeneous Response}
For a given initial condition $x(0)=x_0$ the homogeneous response can be computed as follows:\\
\ptitle{In Modal Coordinates}
\begin{align*}
    \tilde{\mathbf{x}}(t) & =e^{\tilde{\mathbf{A}}t}\tilde{\mathbf{x}}(0) \\
    \tilde{x}_i(t)        & =e^{\lambda_{i}t}\tilde{x}_i(0)
\end{align*}
which means that each mode evolves independently (of other modes) over time.\\
\ptitle{In Standard Coordinates}
\begin{equation*}
    \mathbf{x}(t)=\sum_{i=1}^{n}e^{\lambda_{i}t}\tilde{x}_i(0)\mathbf{v}_i
\end{equation*}
because for an initial condition $x_0 = v_i$ the time response is given by
\begin{equation*}
    \mathbf{x}(t)=e^{\mathbf{A}t}\mathbf{v}_i=e^{\lambda_{i}t}\mathbf{v}_i
\end{equation*}
and $\mathbf{v}_i$ form a basis of the corresponding state space.

\newpar{}
\ptitle{Remarks}
\begin{itemize}
    \item Note that the standard coordinates time response is obtained by simply multiplying the modal components with their eigenvectors and summing over all components.
    \item If the initial conditions are transformed into modal coordinates, then the modes can be observed evolving independently. % TODO: I think this is not correct. If the system is transformed into the modal form then the modes can be observed evolving independently. In order to get the corresponding initial state one has to transform it with the same transformation as the system was transformed.
\end{itemize}

\begin{examplesection}[Example: Simple Pendulum]
    For a simple pendulum with no damping and no input the state model is given by:
    \begin{equation*}
        \dot{\mathbf{x}}=\underbrace{\begin{bmatrix}
                0            & 1 \\
                -\frac{g}{l} & 0
            \end{bmatrix}}_{\mathbf{A}}\mathbf{x}
    \end{equation*}
    where
    \begin{equation*}
        \mathbf{x}=\begin{bmatrix}
            \varphi \\
            \dot{\varphi}
        \end{bmatrix}
    \end{equation*}

    The eigenvalues and eigenvectors of $\mathbf{A}$ are
    \begin{equation*}
        \lambda_{1,2} = \pm j \sqrt{\frac{g}{l}} \qquad \mathbf{v}_{1,2}=\begin{bmatrix}
            1 \\
            \pm j \sqrt{\frac{g}{l}}
        \end{bmatrix}
    \end{equation*}

    With the transformed initial condition
    \noindent\begin{equation*}
        \mathbf{V}^{-1}\mathbf{x}(0) = \mathbf{V}^{-1}{[1, 0]}^{\mathsf{T}} = {\left[\frac{1}{2}, \frac{1}{2}\right]}^{\mathsf{T}} = \tilde{\mathbf{x}}(0)
    \end{equation*}
    the evolution of the modal components can be visualized as follows: % TODO: This is not the evolution of the modal component. I think the original sentence was correct. Its the eigenvector which corresponds to the shape of the mode not the evolution of the mode.

    \includegraphics[width=\linewidth]{images/mode_shapes_pendulum.png}

    Due to the purely complex eigenvalues, the eigenvectors only rotate when evolving over time.

    As we transformed the initial conditions into modal coordinates, the time response in standard coordinates can be recovered by multiplication with the eigenvectors
    \begin{align*}
        \mathbf{x}_{ICR}(t) & = e^{j\sqrt{\frac{g}{l}}t}\frac{1}{2}
        \begin{bmatrix}
            1 \\
            \textcolor{red}{+j \sqrt{\frac{g}{l}}}
        \end{bmatrix} + e^{-j\sqrt{\frac{g}{l}}t}\frac{1}{2}
        \begin{bmatrix}
            1 \\
            \textcolor{red}{-j \sqrt{\frac{g}{l}}}
        \end{bmatrix}                      \\
        \mathbf{x}_{ICR}(t) & = \begin{bmatrix}
                                    \varphi \\
                                    \textcolor{red}{\dot{\varphi}}
                                \end{bmatrix}
        = \begin{bmatrix}
              \cos(\omega t) \\
              \textcolor{red}{-\omega\sin(\omega t)}
          \end{bmatrix}
    \end{align*}    
\end{examplesection}
