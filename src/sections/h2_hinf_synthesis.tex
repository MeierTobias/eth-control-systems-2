\subsection{\texorpdfstring{$\mathcal{H}_2$}{H2} Synthesis}
\subsubsection{LQR}
In the LQR problem we assume
\begin{itemize}
    \item Full state feedback: $\mathbf{C_y}=\mathbf{\mathbb{I}}$
    \item No disturbance input: $w=0$
    \item $C_z^{\mathsf{H}}D_{zu}=0$
\end{itemize}
and try to find a control signal $u(t,x)$ that minimizes
\begin{equation*}
    \|z\|_2^2=\int_0^{+\infty}\|C_z x+D_{zu}u\|_2^2 dt
\end{equation*}
where
\begin{align*}
    C_z=    &
    \begin{bmatrix}
        \sqrt{Q} & 0
    \end{bmatrix}^{\mathsf{T}} \\
    D_{zu}= &
    \begin{bmatrix}
        0 & \sqrt{R}
    \end{bmatrix}^{\mathsf{T}}
\end{align*}
which yields the known LQR problem
\begin{equation*}
    \|z\|_2^2=\int_0^{+\infty}(x^{\mathsf{T}}Qx+u^{\mathsf{T}}Ru)\;dt
\end{equation*}

\ptitle{Technical Considerations}

\begin{enumerate}
    \item $(A,B_u)$ stabilizable.
    \item $(C_z,A)$ detectable.\\
          This ensures that any unstable mode of $A$ is detected by the performance output.
    \item $\begin{vmatrix} A- j\omega I& B_u\\ C_z& D_{zu}\end{vmatrix}$ has full column rank for all $\omega\in\mathbb{R}$\\
          Ensures that control effort is penalized at all $\omega$ so that the Hamiltonian does not have purely imaginary eigenvalues.
    \item $D_{zu}^{\mathsf{H}}D_{zu}=R$, invertible, i.e., $D_{zu}$ has full column rank\\
          Is for convenience.
\end{enumerate}

\ptitle{Remarks}

\begin{itemize}
    \item One can show that this control law is optimal to achieve the stated minimization.
    \item Technical considerations 1.-3.\ ensure that the Riccati equation admits a solution $Y$ that is positive semi-definite.
\end{itemize}


\subsubsection{LQE}
In the LQE problem we assume
\begin{itemize}
    \item That $u$ takes the role uf the observer update
    \item Full state updates: $\mathbf{B_u}=\mathbf{\mathbb{I}}$ ($u$ updates the states)
    \item Zero initial conditions: $\tilde{x}(0)=x(0)-\hat{x}(0)=0$
    \item $B_w D_{yw}^{\mathsf{H}}=0$
\end{itemize}
and try to find an update signal $u(t,\tilde{x})\in \mathcal{L}_2$ that minimizes power in the error signal due to white noise disturbance $w$.

\ptitle{Noise}

Process noise and sensor noise affect the system as
\begin{align*}
    \dot{\tilde{x}}= & A\tilde{x}+B_{w} w   & \text{ affects real, physical state} \\
    y=               & C_y\tilde{x}+D_{yw}w & \text{ affects measurements}
\end{align*}
and are modelled by
\begin{align*}
    B_w=    & \begin{bmatrix}\sqrt{Q}&0\end{bmatrix}^{\mathsf{T}} \\
    D_{yw}= & \begin{bmatrix}0&\sqrt{R}\end{bmatrix}
\end{align*}
where process noise and sensor noise are not correlated i.e.
\begin{equation*}
    \mathbb{E}\left[w^{\mathsf{H}} B_w^{\mathsf{H}} D_{yw}w^{\mathsf{H}}\right]=0
\end{equation*}

\ptitle{Technical Considerations}

\begin{enumerate}
    \item $(C_y,A)$ detectable.\\
          To observe unstable modes.
    \item $(A,B_w)$ stabilizable\\
          That unstable modes are affected by disturbance to actually track it.
    \item $\begin{bmatrix}A-j\omega I&B_w\\C_y&D_{yw}\end{bmatrix}$ has full row rank for all $\omega\in\mathbb{R}$\\
          That errors are penalized at all frequencies and condition on Hamiltonian.
    \item $D_{yw} D_{yw}^{\mathsf{H}}=R_{ww}$ invertible, i.e., $D_{yw}$ has full row rank.\\
          For convenience.
\end{enumerate}

\ptitle{Remarks}

\begin{itemize}
    \item One can show that this control law is optimal to achieve the stated minimization.
    \item Technical considerations 1.-3.\ ensure that the Riccati equation admits a solution $Y$ that is positive semi-definite.
\end{itemize}

\subsubsection{LQG}
Due to the separation principle we can design the LQR and LQE controller separately (assuming all technical considerations are fulfilled). This process yields an optimal controller of the form
\begin{equation*}   %% cleaner method for the lines? %%
    K=\left[\begin{array}{c|cc}
            A+B_u F+LC_y & -L & B_u \\
            \midrule
            F            & 0  & I   \\
            -C_y         & I  & 0
        \end{array}\right]
\end{equation*}
with
\begin{equation*}
    F=-R_{uu}^{-1}(B_{u}^{\mathsf{H}}X+D_{zu}^{\mathsf{H}}C_{z})
\end{equation*}
where $X$ is the stabilizing solution to the corresponding ARE and an observer
\begin{equation*}
    L=-(YC_y^{\mathsf{H}}+B_w D_{yw}^{\mathsf{H}})R_{ww}^{-1}
\end{equation*}
where $Y$ is the stabilizing solution to the corresponding ARE.

\subsection{\texorpdfstring{$\mathcal{H}_\infty$}{H-infinity} Synthesis}
\ptitle{Differentiation from $\mathcal{H}_2$ Synthesis}
\begin{itemize}
    \item $\mathcal{H}_2$ is optimal given
          \begin{enumerate}
              \item The cost trade-offs between the state error and the control effort
              \item The expected covariances of the disturbance and sensor noise
          \end{enumerate}
    \item $\mathcal{H}_2$ specifications are given in time domain: difficult to handle frequency-domain specifications.
    \item For $\mathcal{H}_2$ design one could use a “mixed sensitivity” approach, and further augment the plant $P$ with frequency-dependent weigthing functions.
    \item $\mathcal{H}_\infty$ provides a more direct way to handle \textbf{frequency-domain specifications.}
\end{itemize}

\ptitle{Optimal $\mathcal{H}_\infty$ Synthesis}
\begin{itemize}
    \item In principle, we would like to find a controller K that minimizes the energy ($\mathcal{L}_2$) gain of the CL system i.e.
          \begin{equation*}
              \left\|T_{zw}\right\|_{\mathcal{H}_\infty}=\sup_{w\neq0}\frac{\left\|z\right\|_{\mathcal{L}_2}}{\left\|w\right\|_{\mathcal{L}_2}}
          \end{equation*}
    \item However, the optimal controller(s) are such that
          \begin{enumerate}
              \item $\sigma_{\max}(T_{ZW}(j\omega))$ is a constant over all frequencies, the response does not roll off at high frequencies.
              \item The controller is not strictly proper. (The optimal controller is not unique.)
              \item Computing an optimal controller is numerically challenging
          \end{enumerate}
\end{itemize}

\subsubsection{Suboptimal \texorpdfstring{$\mathcal{H}_\infty$}{H-infinity} Synthesis}
In practice one pursues a sub-optimal design, i.e., given $\gamma>0$, find a controller $K$ such that
\begin{equation*}
    \|T_{zw}\|_{\mathcal{H}_\infty}<\gamma
\end{equation*}
if one exists. This can be formulated mathematically as a cost function:
\begin{equation*}
    \|z\|_{\mathcal{L}_2}^2-\gamma^2\|w\|_{\mathcal{L}_2}^2
\end{equation*}
where we search for the smallest $\gamma$ such that the controller can achieve negative cost. We \textbf{need} $\boldsymbol{\gamma}\mathbf{\le1}$ for a stabilizing controller as otherways for larger gamma one could easily achieve negative cost even though the energy of the disturbance gets not damped at all! The formula can be understood as
\begin{itemize}
    \item $z$ is the performance output given some disturbance $w$
    \item We want to damp $z$ given $w$ (remember the definition of the induced $\mathcal{L}_2$ norm above)
    \item The aforementioned formula becomes negative if the disturbance energy term is larger than the (hopefully damped) performance output $z$. A small $\gamma$ gives an even better controller as it is more difficult to achieve negative cost then.
\end{itemize}

\ptitle{Bisection Algorithm}

\begin{enumerate}
    \item Initialize to, e.g, $\gamma_-=0,\gamma_+=$ the $\mathcal{H}_\infty$ norm of the \textbf{$\mathcal{H}_2$ optimal design} (approximation of a reasonable bound). Let $K_+$ be the optimal $\mathcal{H}_2$ controller.
    \item Let $\gamma\leftarrow(\gamma_-+\gamma_+)/2$. Check whether a controller exists such that $\|T_{zw}\|\mathcal{H}_\infty<\gamma$.
    \item If yes, set $\gamma_+\leftarrow\gamma$, and set $K_+$ to the controller just designed. Otherwise, set $\gamma_-\leftarrow\gamma$.
    \item Repeat from step 2 until $\gamma_+-\gamma_-<\epsilon$.
    \item Return $K_+$.
\end{enumerate}

\ptitle{Simplified Setup}

Solving the problem is simplified if
\begin{itemize}
    \item $C_{z}^{\mathsf{H}}D_{zu}=0$, i.e.,the cost if of the form $\int_0^{+\infty}x^{\mathsf{H}}Qx+u^{\mathsf{H}}Ru\;dt$.
    \item $B_w D_{yw}^{\mathsf{H}}=0$, i.e., process noise and sensor noise are uncorrelated.
    \item $D_{zu}^{\mathsf{H}}D_{zu}=1,D_{yw}D_{yw}^{\mathsf{H}}=1$.
\end{itemize}

