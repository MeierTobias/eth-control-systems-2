\section{LQR}
\subsection{Cost Functional}
LQR can be used to systematically optimize the \textbf{static gain vector K} based on \textit{tracking errors} and \textit{control effort}.

For th   e reference input $r(t) = 0$ the cost functional $J$ is defined as
\noindent\begin{equation*}
    J(\mathbf{x,t})=\int_0^{+\infty} \Bigl[\underbrace{{\mathbf{x}(t)}^T\mathbf{Qx}(t)}_{\textsf{tracking error}} + \underbrace{{\mathbf{u}(t)}^T \mathbf{Ru}(t)}_{\textsf{control effort}} \Bigr]dt
\end{equation*}
\textbf{Remarks:}
\begin{itemize}
    \item $\mathbf{Q}$ is symmetric i.e. $\mathbf{Q}=\mathbf{Q}^T$
    \item $\mathbf{Q}$ is positive semidefinite i.e. $\mathbf{x}^T \mathbf{Qx} \geq 0$ or $eig(\mathbf{Q}) \geq 0$
    \item $\mathbf{Q}$ must give positive weights to unstable modes to penalize them in the cost function ($\mathbf{A}, \sqrt{\mathbf{Q}}$ are detectable)
    \item $\mathbf{R}$ must be positive definite i.e. $\mathbf{u}^T \mathbf{Ru} >0\; \forall u\neq 0$ or $eig(\mathbf{R}) > 0$
    \item The pair $\mathbf{A,B}$ must be stabilizable
    \item In general, there is an additional cross-coupling term $\mathbf{x}^T\mathbf{Nu}$ in $J$ which is often neglected i.e. equal to $0$
\end{itemize}

\subsubsection{Bryson's Rule}
Bryson's rule can be used as a \textit{baseline guess} for $\mathbf{Q,R}$:
\noindent\begin{align*}
    \mathbf{Q} =
     & \begin{bmatrix}\frac{q_1^2}{|x_{1,\max}|^2} &                              &  &        &                              & \\
                                            & \frac{q_2^2}{|x_{2,\max}|^2} &  &        &                              & \\
                                            &                              &  & \ddots &                              & \\
                                            &                              &  &        & \frac{q_n^2}{|x_{n,\max}|^2}
       \end{bmatrix} \\
    \mathbf{R} = \rho
     & \begin{bmatrix}\frac{r_1^2}{|u_{1,\max}|^2} &                              &  &        &                              & \\
                                            & \frac{r_2^2}{|u_{2,\max}|^2} &  &        &                              & \\
                                            &                              &  & \ddots &                              & \\
                                            &                              &  &        & \frac{r_n^2}{|u_{n,\max}|^2}
       \end{bmatrix}
\end{align*}
where
\noindent\begin{equation*}
    \sum_{i=1}^n q_i^2=1\text{ and }\sum_{i=1}^m r_i^2=1
\end{equation*}
and $x_{i,\max}$, $u_{j,\max}$ are the maximum deviations that we are willing to tolerate for the $i$-th state and $j$-th input, respectively.

\subsection{Continuous Time}
In continuous time, first the \textbf{positive definite} solution $\mathbf{P}$ of the \textit{continuous algebraic Riccati equation} (\textbf{\textit{CARE}}) has to be found
\noindent\begin{equation*}
    \mathbf{A}^T \mathbf{P}+\mathbf{PA}+\mathbf{Q}-\mathbf{PBR}^{-1}\mathbf{B}^T \mathbf{P}=0
\end{equation*}
then the \textit{static gain matrix} $\mathbf{K}$ can be obtained by setting $\mathbf{u} = -\mathbf{Kx}$:
\noindent\begin{equation*}
    \mathbf{K}=\mathbf{R}^{-1}\mathbf{B}^T \mathbf{P}
\end{equation*}

\textbf{Remarks:}

\begin{itemize}
    \item LQR guarantees a phase margin of at least 60Â°
    \item LQR applies directly to MIMO-systems
\end{itemize}

\newpar{}
\textbf{\code{Matlab:}} \code{[K,P]=lqr(A,B,Q,R)}


\subsection{Discrete Time}
In discrete time, the cost functional is
\noindent\begin{equation*}
    J(\mathbf{x,u})=\sum_{k=0}^{+\infty}\left({\mathbf{x}[k]}^T \mathbf{Qx}[k]+{\mathbf{u}[k]}^T \mathbf{Ru}[k]\right),
\end{equation*}
the positive definite solution $\mathbf{P}$ to the \textit{discrete algebraic Riccati equation} (\textbf{\textit{DARE}})
\noindent\begin{equation*}
    \mathbf{P}=\mathbf{A}^T \mathbf{PA}-(\mathbf{A}^T \mathbf{PB}){(\mathbf{B}^{\prime}\mathbf{PB}+\mathbf{R})}^{-1}(\mathbf{B}^T \mathbf{PA})+\mathbf{Q}
\end{equation*}
and the \textit{static gain matrix} obtained with $\mathbf{u} = -\mathbf{Kx}$ is
\noindent\begin{equation*}
    \mathbf{K}={(\mathbf{R}+\mathbf{B}^T \mathbf{PB})}^{-1}\mathbf{B}^T \mathbf{PA}
\end{equation*}

\textbf{\code{Matlab:}} \code{[K\_d,P\_d]=dlqr(A,B,Q,R)}

\subsection{Integrator}
If the reference input is $\neq 0$, an integrator can be used to achieve zero-steady error to step inputs.
This simply done by adding the integral of the error to the state space model
\noindent\begin{align*}
    \dot{e} & =-y+r =  -\mathbf{Cx} - \mathbf{Du} + r \\
    \frac d{dt}
    \begin{bmatrix}
        \mathbf{x} \\
        e
    \end{bmatrix}
            & =\begin{bmatrix}
                   \mathbf{A}  & \mathbf{0} \\
                   -\mathbf{C} & 0
               \end{bmatrix}
    \begin{bmatrix}
        \mathbf{x} \\
        e
    \end{bmatrix}
    +\begin{bmatrix}
         \mathbf{B} \\
         \mathbf{D}
     \end{bmatrix}
    \mathbf{u}+
    \begin{bmatrix}
        0 \\
        1
    \end{bmatrix}
    r                                                 \\
            & =\begin{bmatrix}
                   \mathbf{A}  & \mathbf{0} \\
                   -\mathbf{C} & 0
               \end{bmatrix}
    \begin{bmatrix}
        \mathbf{x} \\
        e
    \end{bmatrix}
    +\begin{bmatrix}
         \mathbf{B} & \mathbf{0} \\
         \mathbf{D} & 1
     \end{bmatrix}
    \begin{bmatrix}
        \mathbf{u} \\
        r
    \end{bmatrix},
\end{align*}
then apply LQR to the modified state space model. This method is an alternative to open-loop, feed-forward reference scaling. Feedforward is more dynamic than an integrator but not robust.

\subsection{Symmetric Root Locus}
The symmetric root locus can be used to understand the influence of $\rho$ on the poles of a closed loop LQR feedback system.
By using $\mathbf{Q}=\mathbf{C}^T \mathbf{C}$ and $\mathbf{R}=\rho \mathbf{I}$, the symmetric root locus condition simplifies to
\noindent\begin{align*}
    \rho \mathbf{I}+G(s)G(-s) & =0 \qquad \Leftrightarrow \\
    \rho D(s)D(-s)+N(s)N(-s)  & =0
\end{align*}
where $G(-s)$ corresponds to flipping signs in all the odd coefficients.
\ptitle{Symmetric Root Locus Rules}

\begin{itemize}
    \item $2n$ branches, where $n$ is the size of $\mathbf{A}$
    \item symmetric to the real and imaginary axis
    \item LQR closed-loop poles are all in the LHP
    \item $\rho \rightarrow \infty$ (expensive control):\newline
          cl.\ poles approach stable ol.\ poles and the mirror-images of the unstable ol.\ poles (all on LHP)
    \item $\rho \rightarrow 0$ (cheap control):\newline
          cl.\ poles approach mp.\ ol.\ zeros and the mirror-images of the nmp.\ ol.\ zeros or go to infinity along the LHP asymptotes (all on LHP)
\end{itemize}

\begin{examplesection}[Example: Symmetric Root Locus]
    Consider the LTI system
    \noindent\begin{equation*}
        G = \frac{s-1}{(s-0.5)(s^2+2s+s)}
    \end{equation*}
    the corresponding root-loci are
    \begin{center}
        \includegraphics[width = \linewidth]{symm_rlocus.png}
    \end{center}
    Here the open-loop system features both a nonminimum-phase zero and an unstable pole.
    When looking at the left half of the \textit{symmetric root locus}, the mirrored nmp.\ zero and unstable pole stabilize the system such that
    for any $\rho$ the closed loop poles will stay on the LHP.
\end{examplesection}